#
# Sample configuration file for ISC dhcpd for Debian
#
# Attention: If /etc/ltsp/dhcpd.conf exists, that will be used as
# configuration file instead of this file.
#
#

# The ddns-updates-style parameter controls whether or not the server will
# attempt to do a DNS update when a lease is confirmed. We default to the
# behavior of the version 2 packages ('none', since DHCP v2 didn't
# have support for DDNS.)
ddns-update-style none;

# option definitions common to all supported networks...
option domain-name "aos-demo.com";

#option domain-name-servers ns1.example.org, ns2.example.org;

default-lease-time 7200;
max-lease-time 7200;

# If this DHCP server is the official DHCP server for the local
# network, the authoritative directive should be uncommented.
authoritative;

# Use this to send dhcp log messages to a different log file (you also
# have to hack syslog.conf to complete the redirection).

log-facility local7;

# The specific settings for Cumulus ONIE process
option cumulus-provision-url code 239 = text;

class "aos-server" {
   match if (option host-name = "aos-server");
}

class "cumulus-switch" {
   match if (substring(option host-name, 0, 7) = "cumulus");
   option default-url = "http://192.168.59.254/cumulus/onie-installer";
   option cumulus-provision-url "http://192.168.59.254/cumulus/cumulus-ztp.sh";
}

class "eos-switch" {
   match if (substring(option vendor-class-identifier, 0, 6) = "Arista");
   option bootfile-name "arista-ztp.sh";
}

class "nxos-switch" {
   match if (substring(option vendor-class-identifier, 0, 5) = "Cisco");
   option bootfile-name "nxos-poap.py";
}

# include "/etc/dhcp/dhcpd.conf.reserved";

subnet 192.168.59.0 netmask 255.255.255.0 {
   option tftp-server-name "192.168.59.254";
   option routers 192.168.59.1;
   option domain-name-servers 192.168.59.254;
   pool {
      allow members of "aos-server";
      range 192.168.59.250 192.168.59.250;
   }

   pool {
      deny members of "aos-server";
      range 192.168.59.210 192.168.59.249;
   }
}

on commit {
  set client_IP = binary-to-ascii(10, 8, ".", leased-address);
  set client_Mac = binary-to-ascii(16, 8, ":", substring(hardware, 1, 6));
  set client_Name = pick-first-value(option fqdn.hostname, option host-name);
  log(concat("Commit: IP: ", client_IP, " Mac: ", client_Mac, " Host: ", client_Name));
  execute("/etc/dhcp/scripts/add_dhcp_host.sh", client_IP, client_Name);
}

include "/etc/dhcp/l3se-dhcp.conf";
